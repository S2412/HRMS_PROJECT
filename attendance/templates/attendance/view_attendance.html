{% extends 'attendance/base.html' %}
{% block content %}
<div class="container mt-4">
  <h4 class="mb-4 text-center">Attendance Records for {{ employee_name }}</h4>

  {% if request.user.is_staff or request.user.is_superuser %}
    <div class="mb-4">
      <label class="form-label">Select Employee</label>
      <select id="employee-selector" class="form-select">
        <option value="">-- Choose Employee --</option>
        {% for user in all_users %}
          <option value="{{ user.username }}" {% if user.username == employee_name %}selected{% endif %}>
            {{ user.get_full_name|default:user.username }}
          </option>
        {% endfor %}
      </select>
    </div>
  {% endif %}

  {% if records %}
    <div class="table-responsive">
      <table class="table table-bordered table-striped">
        <thead class="table-primary">
          <tr>
            <th>Date</th>
            <th>Check-In</th>
            <th>Check-Out</th>
            <th>Status</th>
            <th>Overtime</th>
          </tr>
        </thead>
        <tbody>
          {% for record in records %}
            <tr>
              <td>{{ record.date|date:"d M Y" }}</td>
              <td>{{ record.check_in|time:"h:i A" }}</td>
              <td>{{ record.check_out|time:"h:i A" }}</td>
              <td>{{ record.status }}</td>
              <td>
                {% if record.is_overtime_manual %}
                  {{ record.overtime_hours }} hrs
                {% else %}
                  â€”
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info text-center">No attendance records found.</div>
  {% endif %}
</div>

<script>
  const selector = document.getElementById("employee-selector");
  if (selector) {
    selector.addEventListener("change", function () {
      const username = this.value;
      if (username) {
        window.location.href = `?username=${username}`;
      }
    });
  }
</script>
{% endblock %}